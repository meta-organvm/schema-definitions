{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://meta-organvm.github.io/schema-definitions/soak-test.schema.json",
  "title": "Soak Test Snapshot",
  "description": "Schema for daily soak test snapshots collected during the VIGILIA 30-day observation period.",
  "type": "object",
  "required": ["date", "collected_at", "validation", "ci"],
  "properties": {
    "date": {
      "type": "string",
      "format": "date"
    },
    "collected_at": {
      "type": "string",
      "format": "date-time"
    },
    "dry_run": { "type": "boolean" },
    "validation": {
      "type": "object",
      "required": ["registry_pass", "dependency_pass"],
      "properties": {
        "registry_pass": { "type": "boolean" },
        "registry_issues": {
          "type": "array",
          "items": { "type": "string" }
        },
        "dependency_pass": { "type": "boolean" },
        "dependency_violations": { "type": "integer", "minimum": 0 },
        "stale_repos": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "ci": {
      "type": "object",
      "required": ["total_checked", "passing", "failing"],
      "properties": {
        "total_checked": { "type": "integer", "minimum": 0 },
        "passing": { "type": "integer", "minimum": 0 },
        "failing": { "type": "integer", "minimum": 0 },
        "unknown": { "type": "integer", "minimum": 0 },
        "failures": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "engagement": {
      "type": "object",
      "properties": {
        "total_stars": { "type": "integer", "minimum": 0 },
        "total_forks": { "type": "integer", "minimum": 0 },
        "top_repos": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "stars": { "type": "integer" },
              "forks": { "type": "integer" },
              "views_14d": { "type": "integer" },
              "clones_14d": { "type": "integer" }
            }
          }
        }
      }
    }
  }
}
